(()=>{"use strict";const e=document.querySelector(".img-upload__scale"),t=document.querySelector(".img-upload__preview"),r=e.querySelector(".scale__control--smaller"),o=e.querySelector(".scale__control--bigger"),c=t.querySelector("img"),n=e.querySelector(".scale__control--value"),l=e=>"scale("+parseInt(e)/100,s=()=>{n.value="100%",c.style.transform=l(n.value)},i=0,a=1,d=0,u=1,m=0,v=100,y=0,p=3,f=1,g=3,S=document.querySelector(".img-upload__effects"),L=S.querySelector('[for="effect-chrome"]'),h=S.querySelector('[for="effect-sepia"]'),q=S.querySelector('[for="effect-marvin"]'),b=S.querySelector('[for="effect-phobos"]'),E=S.querySelector('[for="effect-heat"]'),k=S.querySelector('[for="effect-none"]'),w=document.querySelector(".img-upload__effect-level"),C=w.querySelector(".effect-level__value"),x=w.querySelector(".effect-level__slider"),A=()=>{x.noUiSlider&&x.noUiSlider.destroy()},U=()=>{c.className="",c.style.filter="none",C.setAttribute("value",""),x.setAttribute("disabled",!0)},N=e=>"Escape"===e.key;let $=5;const I=document.body,j=document.querySelector(".pictures"),D=document.querySelector(".big-picture"),V=D.querySelector(".social__comment-count"),F=D.querySelector(".comments-loader"),z=D.querySelector(".big-picture__cancel"),T=D.querySelector(".social__comments"),M=document.querySelector("#comment").content.querySelector(".social__comment"),O=document.createDocumentFragment(),P=e=>{e.comments.slice(0,$).forEach((({avatar:e,message:t,name:r})=>{const o=M.cloneNode(!0);o.querySelector(".social__picture").src=e,o.querySelector(".social__picture").alt=r,o.querySelector(".social__text").textContent=t,O.appendChild(o)})),T.appendChild(O),(e=>{e.comments.length>0&&(V.innerHTML=`${T.children.length} из <span class="comments-count">${e.comments.length}</span> комментариев`)})(e)},R=document.querySelector(".pictures"),H=document.querySelector("#picture").content.querySelector(".picture"),W=document.createDocumentFragment(),B=()=>{R.querySelectorAll(".picture").forEach((e=>{R.removeChild(e)}))},G=e=>{e.forEach((({url:e,likes:t,comments:r})=>{const o=H.cloneNode(!0);o.querySelector(".picture__img").src=e,o.querySelector(".picture__likes").textContent=t,o.querySelector(".picture__comments").textContent=r.length,W.appendChild(o)})),R.appendChild(W),(e=>{const t=j.querySelectorAll("a");for(let r=0;r<t.length;r++){const o=()=>{D.classList.add("hidden"),I.classList.remove("modal-open"),T.textContent="",$=5,F.removeEventListener("click",s),document.removeEventListener("keydown",n)},c=o,n=e=>{N(e)&&c()},l=e=>{D.querySelectorAll(".social__comment").forEach((e=>{T.removeChild(e)})),$+=5,P(e),i(e)},s=()=>l(e[r]),i=e=>{$>e.comments.length?(F.classList.add("hidden"),F.removeEventListener("click",s)):(F.classList.remove("hidden"),F.addEventListener("click",s))};t[r].addEventListener("click",(()=>{D.classList.remove("hidden"),D.querySelector(".big-picture__img img").src=e[r].url,D.querySelector(".big-picture__img img").alt=e[r].description,D.querySelector(".likes-count").textContent=e[r].likes,D.querySelector(".comments-count").textContent=e[r].comments.length,D.querySelector(".social__caption").textContent=e[r].description,P(e[r]),i(e[r]),I.classList.add("modal-open"),z.addEventListener("click",o),document.addEventListener("keydown",n)}))}})(e)},J=document.querySelector(".img-filters"),K=J.querySelector("#filter-default"),Q=J.querySelector("#filter-random"),X=J.querySelector("#filter-discussed"),Y=document.querySelector("main"),Z=document.querySelector("#success").content.querySelector(".success").cloneNode(!0),ee=Z.querySelector(".success__button"),te=document.querySelector("#error").content.querySelector(".error").cloneNode(!0),re=te.querySelector(".error__button"),oe=()=>{Y.removeChild(Z),document.removeEventListener("click",se),document.removeEventListener("keydown",ne)},ce=()=>{Y.removeChild(te),document.removeEventListener("click",ie),document.removeEventListener("keydown",le)},ne=e=>{N(e)&&oe()},le=e=>{N(e)&&ce()},se=e=>{"success"===e.target.className&&oe()},ie=e=>{"error"===e.target.className&&ce()},ae=oe,de=ce,ue=/^#[А-яёA-z0-9]+$/i,me="Oдинаковые хэш-теги недопустимы",ve="#ff4040",ye=document.querySelector(".text__description"),pe=document.querySelector(".text__hashtags"),_e=()=>{ye.validity.tooLong?(ye.setCustomValidity("Комментарий должен быть не более 140 символов"),ye.style.border="#ff4040 solid 3px",ye.style.color=ve):(ye.setCustomValidity(""),ye.style.borderColor="",ye.style.color=""),ye.reportValidity()},fe=()=>{const e=[],t=pe.value.trim().toLowerCase().split(" ");t.forEach(((r,o)=>{ue.test(r)||""===r||"#"===r||e.push("Недопустимые знаки"),r.length>20&&e.push("Хэш-тег не может быть больше 20-ти символов");for(let r=1;r<t.length;r++)t[o]===t[r]&&o!==r&&(e.includes(me)||e.push(me))})),t.length>5&&e.push("Хэш-тегов не должно быть больше пяти"),pe.setCustomValidity(e.join(". ")),pe.reportValidity(),e.length?(pe.style.border="#ff4040 solid 3px",pe.style.color=ve):(pe.style.borderColor="",pe.style.color="")},ge=e=>{e.stopPropagation()},Se=()=>{ye.removeEventListener("invalid",_e),pe.removeEventListener("input",fe),pe.removeEventListener("keydown",ge),ye.removeEventListener("keydown",ge)},Le=["gif","jpg","jpeg","png"],he=document.querySelector(".img-upload__form"),qe=he.querySelector(".img-upload__input"),be=he.querySelector(".img-upload__overlay"),Ee=be.querySelector(".img-upload__cancel"),ke=document.querySelector("body"),we=he.querySelectorAll(".effects__preview"),Ce=()=>{be.classList.add("hidden"),ke.classList.remove(".modal-open"),he.reset(),he.removeEventListener("submit",xe),document.removeEventListener("keydown",Ae)},xe=e=>{e.preventDefault(),((e,t,r)=>{fetch("https://23.javascript.pages.academy/kekstagram",{method:"POST",body:r}).then((()=>{Y.appendChild(Z),ee.addEventListener("click",ae),document.addEventListener("keydown",ne),document.addEventListener("click",se)})).catch((()=>{Y.appendChild(te),re.addEventListener("click",de),document.addEventListener("keydown",le),document.addEventListener("click",ie)}))})(0,0,new FormData(e.target)),Ce(),s(),U()},Ae=e=>{N(e)&&(Ce(),s(),U(),Se())},Ue=()=>{Ce(),s(),U(),Se()};qe.addEventListener("change",(()=>{(()=>{const e=qe.files[0],t=e.name.toLowerCase();if(Le.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{c.src=t.result,we.forEach((e=>{e.style.backgroundImage=`url(${t.result})`}))})),t.readAsDataURL(e)}})(),he.addEventListener("submit",xe),be.classList.remove("hidden"),ke.classList.add("modal-open"),Ee.addEventListener("click",Ue),document.addEventListener("keydown",Ae),r.addEventListener("click",(()=>{n.value=parseInt(n.value)-25+"%",parseInt(n.value)<25&&(n.value="25%"),c.style.transform=l(n.value)})),o.addEventListener("click",(()=>{n.value=parseInt(n.value)+25+"%",parseInt(n.value)>100&&(n.value="100%"),c.style.transform=l(n.value)})),L.addEventListener("click",(()=>{A(),c.className="effects__preview--chrome",noUiSlider.create(x,{range:{min:i,max:a},start:1,step:.1,connect:"lower"}),x.removeAttribute("disabled"),x.noUiSlider.on("update",(e=>{C.setAttribute("value",e[0]),c.style.filter=`grayscale(${C.value})`}))})),h.addEventListener("click",(()=>{A(),c.className="effects__preview--sepia",noUiSlider.create(x,{range:{min:d,max:u},start:1,step:.1,connect:"lower"}),x.removeAttribute("disabled"),x.noUiSlider.on("update",(e=>{C.setAttribute("value",e[0]),c.style.filter=`sepia(${C.value})`}))})),q.addEventListener("click",(()=>{A(),c.className="effects__preview--marvin",noUiSlider.create(x,{range:{min:m,max:v},start:100,step:.1,connect:"lower"}),x.removeAttribute("disabled"),x.noUiSlider.on("update",(e=>{C.setAttribute("value",e[0]),c.style.filter=`invert(${C.value}%)`}))})),b.addEventListener("click",(()=>{A(),c.className="effects__preview--phobos",noUiSlider.create(x,{range:{min:y,max:p},start:3,step:.1,connect:"lower"}),x.removeAttribute("disabled"),x.noUiSlider.on("update",(e=>{C.setAttribute("value",e[0]),c.style.filter=`blur(${C.value}px)`}))})),E.addEventListener("click",(()=>{A(),c.className="effects__preview--heat",noUiSlider.create(x,{range:{min:f,max:g},start:3,step:.1,connect:"lower"}),x.removeAttribute("disabled"),x.noUiSlider.on("update",(e=>{C.setAttribute("value",e[0]),c.style.filter=`brightness(${C.value})`}))})),k.addEventListener("click",(()=>{U()})),ye.addEventListener("invalid",_e),pe.addEventListener("input",fe),pe.addEventListener("keydown",ge),ye.addEventListener("keydown",ge)})),fetch("https://23.javascript.pages.academy/kekstagram/data").then((e=>e.json())).then((e=>{G(e),J.classList.remove("img-filters--inactive"),K.addEventListener("click",(()=>{K.classList.add("img-filters__button--active"),Q.classList.remove("img-filters__button--active"),X.classList.remove("img-filters__button--active")})),Q.addEventListener("click",(()=>{Q.classList.add("img-filters__button--active"),K.classList.remove("img-filters__button--active"),X.classList.remove("img-filters__button--active")})),X.addEventListener("click",(()=>{X.classList.add("img-filters__button--active"),K.classList.remove("img-filters__button--active"),Q.classList.remove("img-filters__button--active")})),(e=>{J.addEventListener("click",_.debounce((()=>(e=>{Q.classList.contains("img-filters__button--active")?(B(),G(e.slice().sort((()=>.5-Math.random())).slice(0,10))):X.classList.contains("img-filters__button--active")?(B(),G(e.slice().sort(((e,t)=>t.comments.length-e.comments.length)))):(B(),G(e))})(e)),500))})(e)})).catch((()=>{(e=>{const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent="Ошибка загрузки изображений",document.body.append(t),setTimeout((()=>{t.remove()}),5e3)})()}))})();
//# sourceMappingURL=main.bundle.js.map